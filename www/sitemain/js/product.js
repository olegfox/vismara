// Generated by CoffeeScript 1.10.0
var Product;

Product = {
  detectmob: function() {
    if (navigator.userAgent.match(/Android/i) || navigator.userAgent.match(/webOS/i) || navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/BlackBerry/i) || navigator.userAgent.match(/Windows Phone/i)) {
      return true;
    } else {
      return false;
    }
  },
  loadImage: function($img, width) {
    $img.one('load', function() {
      if (width) {
        Product.cropImage($img, width);
      } else {
        Product.cropImage($img);
      }
      setTimeout((function() {
        $img.css({
          'visibility': 'visible'
        });
      }), 200);
    }).each(function() {
      if (this.complete) {
        $(this).load();
      }
    });
  },
  showProduct: function(product) {
    var timeout;
    timeout = 0;
    $('#mobileMeta').remove();
    $('head').append('<meta id="mobileMeta" name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>');
    $('body').css({
      'overflow-x': 'hidden'
    });
    $('body > .wrap').hide();
    $('body > .icone').hide();
    $('body > .language').hide();
    $('body').append('<div class="global-background"></div>');
    if ($('.global').length > 0) {
      $('.global').remove();
      $('.form-product-feedback').remove();
    }
    setTimeout((function() {
      $('body').append(JSON.parse($(product).data('html')));
      if (window.history.pushState) {
        window.history.pushState(null, null, $(product).attr('href'));
      }
      $('.global .ar_close').unbind('click touchstart').bind('click touchstart', function() {
        $('body').css({
          'overflow-x': 'auto'
        });
        $('body > .wrap').show();
        $('body > .icone').show();
        $('body > .language').show();
        $('.global-background').remove();
        $('#mobileMeta').remove();
        $('head').append('<meta id="mobileMeta" name="viewport" content=""/>');
        $('.global').remove();
        $('.form-product-feedback').remove();
        window.history.back();
      });
      $('.global .message').unbind('click touhstart').bind('click touchstart', function() {
        $('.global').hide();
        $('.form-product-feedback').show();
      });
      $('.form-product-feedback #back').unbind('click touchstart').bind('click touchstart', function() {
        $('.global').show();
        $('.form-product-feedback').hide();
      });
      $('.form-product-feedback #submit').unbind('click touchstart').bind('click touchstart', function() {
        var $form, $submitButton;
        $submitButton = $(this);
        $submitButton.css('width', $submitButton.outerWidth());
        $submitButton.addClass('loader').attr('disable', 'disable');
        $form = $('.form-product-feedback form');
        $.post($form.attr('action'), $form.serialize(), function(response) {
          if (response.status === 'OK') {
            $form[0].reset();
            $form.find('input[type="text"]').removeClass('error');
            $form.find('input[type="email"]').removeClass('error');
            $form.find('textarea').removeClass('error');
            $submitButton.hide();
            $form.find('.successfully').show();
            setTimeout((function() {
              $form.find('.successfully').hide();
              $submitButton.show();
              $('.wrap-back button').click();
            }), 3000);
          } else {
            if (response.firstname.status !== 'OK') {
              $form.find('#firstname').addClass('error');
            } else {
              $form.find('#firstname').removeClass('error');
            }
            if (response.lastname.status !== 'OK') {
              $form.find('#lastname').addClass('error');
            } else {
              $form.find('#lastname').removeClass('error');
            }
            if (response.country.status !== 'OK') {
              $form.find('#country').addClass('error');
            } else {
              $form.find('#country').removeClass('error');
            }
            if (response.email.status !== 'OK') {
              $form.find('#email_first').addClass('error');
              $form.find('#email_second').addClass('error');
            } else {
              $form.find('#email_first').removeClass('error');
              $form.find('#email_second').removeClass('error');
            }
            if (response.phone.status !== 'OK') {
              $form.find('#phone').addClass('error');
            } else {
              $form.find('#phone').removeClass('error');
            }
            if (response.text.status !== 'OK') {
              $form.find('#text').addClass('error');
            } else {
              $form.find('#text').removeClass('error');
            }
          }
          $submitButton.removeClass('loader').css('width', 'auto').attr('disable', '');
        });
      });
      $('.global .arrow_right').unbind('click touchstart').bind('click touchstart', function(e) {
        e.preventDefault();
        Product.showProduct($(product).parent().next().find('a:first'));
      });
      $('.global .arrow_left').unbind('click touchstart').bind('click touchstart', function(e) {
        e.preventDefault();
        Product.showProduct($(product).parent().prev().find('a:first'));
      });
      if ($(product).parent().next().find('a:first').length <= 0) {
        $('.global .arrow_right').hide();
      } else {
        $('.global .arrow_right').show();
      }
      if ($(product).parent().prev().find('a:first').length <= 0) {
        $('.global .arrow_left').hide();
      } else {
        $('.global .arrow_left').show();
      }
      $('body').unbind('keydown').keydown(function(e) {
        if (e.keyCode === 37) {
          $('.global .arrow_left').click();
        } else if (e.keyCode === 39) {
          $('.global .arrow_right').click();
        } else if (e.keyCode === 27) {
          $('.global .ar_close img').click();
        }
      });
      $('.global .readmore').unbind('click touchstart').bind('click touchstart', function(e) {
        var $content;
        e.preventDefault();
        $content = JSON.parse($('.global .text .inner-text').attr('data-full-text'));
        $('.global .text .inner-text').html($content);
        $('.global .container').css({
          'height': $('.global .pop_right').height()
        });
        return false;
      });
      $('.global .slider').slick({
        dots: true,
        infinite: true,
        arrows: false
      });
      $('.global .slider').on('setPosition', function(slick) {
        return $('.global .slider .slick-track').css('line-height', $('.global .slider .slick-track').height() + 'px');
      });
      $('.global .slider').on('beforeChange', function(event, slick, currentSlide, nextSlide) {
        return $('.global .slider .slick-track').css('line-height', $('.global .slider .slick-track').height() + 'px');
      });
    }), timeout);
    return false;
  }
};
